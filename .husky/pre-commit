#!/bin/sh

# pre-commit hook for quality checks
echo "ğŸ± Pre-commit checks starting..."

# Run lint-staged for incremental checks
npx lint-staged

# Run full quality checks
echo "ğŸ“‹ Running quality checks..."

# 1. Lint check
echo "ğŸ” Running lint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Lint check failed! Please fix lint errors before committing."
  exit 1
fi

# 2. Type check
echo "ğŸ“ Running type check..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ Type check failed! Please fix type errors before committing."
  exit 1
fi

# 3. Unit tests
echo "ğŸ§ª Running unit tests..."
npm test -- --watchAll=false
if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed! Please fix failing tests before committing."
  exit 1
fi

# 4. Security audit
echo "ğŸ”’ Running security audit..."
npm audit --audit-level=moderate
if [ $? -ne 0 ]; then
  echo "âš ï¸ Security audit found vulnerabilities! Please review and fix if possible."
  # Note: Not blocking commit for audit issues, just warning
fi

echo "âœ… All pre-commit checks passed! ğŸ‰"
